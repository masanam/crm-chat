"use strict";document.addEventListener("DOMContentLoaded",(function(){!async function(){await L(),async function(){try{const e=await fetch("https://crm.pasima.co/api/internal-notes/1");(await e.json()).forEach((e=>{var t=document.createElement("li");t.className="timeline-item pb-4 timeline-item-info border-left-dashed",t.innerHTML=`\n                  <span class="timeline-indicator-advanced timeline-indicator-info">\n                      <i class="ti ti-user-circle rounded-circle"></i>\n                  </span>\n                  <div class="timeline-event pb-3">\n                      <div class="timeline-header">\n                          <span class="text-muted">${w(e.created_at,p)}</span>\n                      </div>\n                      <div class="timeline-header">\n                          <span class="text-muted">${w(e.created_at,h)}</span>\n                      </div>\n                      <p>${e.message}</p>\n                      <hr />\n                      <div class="d-flex justify-content-between flex-wrap gap-2">\n                          <div class="d-flex flex-wrap">\n                              <div>\n                                  <p class="mb-0">Dandi</p>\n                              </div>\n                          </div>\n                      </div>\n                  </div>\n              `,r.appendChild(t)}))}catch(e){console.error("Error fetching data:",e)}}(),setInterval(L,1500);const e=document.querySelector(".app-chat-contacts .sidebar-body"),t=[].slice.call(document.querySelectorAll(".chat-contact-list-item:not(.chat-contact-list-item-title)")),a=document.querySelector(".chat-history-body"),n=(document.querySelector(".app-chat-sidebar-left .sidebar-body"),document.querySelector(".app-chat-sidebar-right .sidebar-body"),[].slice.call(document.querySelectorAll(".form-check-input[name='chat-user-status']"))),s=$(".chat-sidebar-left-user-about"),i=document.querySelector(".form-send-message"),c=document.querySelector(".form-send-internal-message"),r=document.querySelector(".internal-notes-history"),l=document.querySelector(".message-input"),o=document.querySelector("#USERID"),d=document.querySelector(".internal-message-input"),m=document.querySelector(".chat-search-input"),u=$(".speech-to-text"),v={active:"avatar-online",offline:"avatar-offline",away:"avatar-away",busy:"avatar-busy"};f();const p={weekday:"long",year:"numeric",month:"long",day:"numeric"},h={hour:"numeric",minute:"numeric"};function f(){a.scrollTo(0,a.scrollHeight)}e&&new PerfectScrollbar(e,{wheelPropagation:!1,suppressScrollX:!0}),a&&new PerfectScrollbar(a,{wheelPropagation:!1,suppressScrollX:!0}),f(),s.length&&s.maxlength({alwaysShow:!0,warningClass:"label label-success bg-success text-white",limitReachedClass:"label label-danger",separator:"/",validate:!0,threshold:120});var g=document.querySelector("#flatpickr-date");function y(e,t,a,n){e.forEach((e=>{let n=e.textContent.toLowerCase();a?-1<n.indexOf(a)?(e.classList.add("d-flex"),e.classList.remove("d-none"),t++):e.classList.add("d-none"):(e.classList.add("d-flex"),e.classList.remove("d-none"),t++)})),0==t?n.classList.remove("d-none"):n.classList.add("d-none")}function w(e,t){var a=t;return new Intl.DateTimeFormat("en-US",a).format(new Date(e))}if(g&&g.flatpickr({monthSelectorType:"static"}),n.forEach((e=>{e.addEventListener("click",(e=>{let t=document.querySelector(".chat-sidebar-left-user .avatar"),a=e.currentTarget.value;t.removeAttribute("class"),Helpers._addClass("avatar avatar-xl "+v[a],t);let n=document.querySelector(".app-chat-contacts .avatar");n.removeAttribute("class"),Helpers._addClass("flex-shrink-0 avatar "+v[a]+" me-3",n)}))})),t.forEach((e=>{e.addEventListener("click",(e=>{t.forEach((e=>{e.classList.remove("active")})),e.currentTarget.classList.add("active")}))})),m&&m.addEventListener("keyup",(e=>{let t=e.currentTarget.value.toLowerCase(),a=document.querySelector(".chat-list-item-0"),n=document.querySelector(".contact-list-item-0"),s=[].slice.call(document.querySelectorAll("#chat-list li:not(.chat-contact-list-item-title)")),i=[].slice.call(document.querySelectorAll("#contact-list li:not(.chat-contact-list-item-title)"));y(s,0,t,a),y(i,0,t,n)})),i.addEventListener("submit",(e=>{e.preventDefault();var t;(t=RegExp("[?&]"+name+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(t[1].replace(/\+/g," "));if(l.value){let e=document.createElement("li");e.className="chat-message chat-message-right",e.innerHTML=`\n          <div class="d-flex overflow-hidden">\n              <div class="chat-message-wrapper flex-grow-1">\n                  <div class="chat-message-text">\n                      <p class="mb-0">${l.value}</p>\n                  </div>\n                  <div class="text-end text-muted mt-1">\n                      <i class='ti ti-checks ti-xs me-1 text-muted'></i>\n                      <small>${function(){const e=new Date;return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}()}</small>\n                  </div>\n              </div>\n              <div class="user-avatar flex-shrink-0 ">\n                    <div class="avatar"><span class="avatar-initial rounded-8 text-dark fw-bolder sender-avatar">D</span></div>\n                </div>\n          </div>\n        `,document.querySelector(".chat-history").appendChild(e),fetch("https://crm.pasima.co/api/send-whatsapp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:"+6281217071702",message:l.value,user_id:o.value})}).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{console.log(e)})).catch((e=>{console.error("There was a problem with the fetch operation:",e)})),l.value="",f()}})),u.length){var b=b||webkitSpeechRecognition;if(null!=b){var x=new b,S=!1;u.on("click",(function(){const e=$(this);x.onspeechstart=function(){S=!0},!1===S&&x.start(),x.onerror=function(e){S=!1},x.onresult=function(t){e.closest(".form-send-message").find(".message-input").val(t.results[0][0].transcript)},x.onspeechend=function(e){S=!1,x.stop()}}))}}async function L(){console.log("GET CHAT");fetch("https://crm.pasima.co/api/get-chats/+6281217071702").then((e=>e.json())).then((e=>{document.querySelector(".chat-history").innerHTML="",e.forEach((e=>{var t="";switch(e.user_id){case 1:t="Admin";break;case 2:t="Dandi"}var a=t.match(/\b\w/g)||[];a=((a.shift()||"")+(a.pop()||"")).toUpperCase();const n=document.createElement("li");"+14155238886"===e.from?(n.className="chat-message chat-message-right",n.innerHTML=`\n            <div class="d-flex align-items-end overflow-hidden">\n                <div class="chat-message-wrapper flex-grow-1 w-50">\n                    <div class="chat-message-text">\n                        <p class="mb-0">${e.message}</p>\n                    </div>\n                    <div class="text-end text-muted mt-1">\n                      <small>${w(e.created_at,h)}</small>\n                      <i class='ti ti-checks ti-xs me-1'></i>\n                    </div>\n                    <div class="text-end text-muted mt-1">\n                      <small class="sender-message">${t}</small>\n                    </div>\n                </div>\n                <div class="user-avatar flex-shrink-0 ">\n                    <div class="avatar"><span class="avatar-initial rounded-8 text-dark fw-bolder sender-avatar">${a}</span></div>\n                </div>\n            </div>\n          `):(n.className="chat-message",n.innerHTML=`\n            <div class="d-flex align-items-end overflow-hidden">\n                <div class="user-avatar flex-shrink-0 me-2">\n                    <div class="avatar"><span class="avatar-initial rounded-8 bg-label-success text-dark fw-bolder">AR</span></div>\n                </div>\n                <div class="chat-message-wrapper flex-grow-1">\n                    <div class="chat-message-text">\n                        <p class="mb-0">${e.message}</p>\n                    </div>\n                    <div class="text-muted mt-1">\n                        <small>${w(e.created_at,h)}</small>\n                    </div>\n                </div>\n            </div>\n          `),document.querySelector(".chat-history").append(n)}))})).catch((e=>console.error("Error fetching data:",e)))}c.addEventListener("submit",(async e=>{if(e.preventDefault(),d.value)try{const e=await fetch("https://crm.pasima.co/api/internal-notes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:1,lead_id:1,message:d.value})});if(e.ok){console.log("Data posted successfully!");const a=await e.json(),n=a.created_at,s=a.message;var t=document.createElement("li");t.className="timeline-item pb-4 timeline-item-info border-left-dashed",t.innerHTML=`\n                      <span class="timeline-indicator-advanced timeline-indicator-info">\n                          <i class="ti ti-user-circle rounded-circle"></i>\n                      </span>\n                      <div class="timeline-event pb-3">\n                          <div class="timeline-header">\n                              <span class="text-muted">${w(n,p)}</span>\n                          </div>\n                          <div class="timeline-header">\n                              <span class="text-muted">${w(n,h)}</span>\n                          </div>\n                          <p>${s}</p>\n                          <hr />\n                          <div class="d-flex justify-content-between flex-wrap gap-2">\n                              <div class="d-flex flex-wrap">\n                                  <div>\n                                      <p class="mb-0">Dandi</p>\n                                  </div>\n                              </div>\n                          </div>\n                      </div>\n                  `,r.appendChild(t),d.value=""}else console.error("Failed to post data:",e.statusText)}catch(e){console.error("Error posting data:",e)}}))}()}));
